#!/usr/bin/env bash
#
# nocp - LLM Proxy Agent Entry Point
#
# This script provides a seamless interface to the nocp tool,
# automatically handling uv installation and execution.
#

set -e

# Get the directory where this script lives
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Ensure we're in the project root
cd "$SCRIPT_DIR"

# Bootstrap uv (will install if not present)
if ! ./src/nocp/bootstrap.py; then
    echo "❌ Failed to bootstrap uv. Cannot continue."
    exit 1
fi

# Find uv binary
UV_BIN=""
if command -v uv &> /dev/null; then
    UV_BIN="uv"
elif [ -f "$HOME/.local/bin/uv" ]; then
    UV_BIN="$HOME/.local/bin/uv"
elif [ -f "$HOME/.cargo/bin/uv" ]; then
    UV_BIN="$HOME/.cargo/bin/uv"
else
    echo "❌ uv not found after bootstrap. Please check your PATH."
    exit 1
fi

# Execute command via uv
# This ensures all dependencies are available and creates venv if needed
exec "$UV_BIN" run python -m nocp "$@"
